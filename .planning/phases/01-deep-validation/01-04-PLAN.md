---
phase: 01-deep-validation
plan: 04
type: execute
wave: 2
depends_on:
  - "01-01"
  - "01-02"
  - "01-03"
files_modified:
  - frontend/src/types/validation.ts
  - frontend/src/hooks/useDeepValidationConfig.ts
  - frontend/src/components/validation/DeepValidationTab.tsx
  - frontend/src/components/validation/DeepCheckCard.tsx
  - frontend/src/components/validation/SeverityConfigPanel.tsx
  - frontend/src/components/validation/StereoisomerList.tsx
  - frontend/src/components/validation/FragmentClassificationTable.tsx
  - frontend/src/pages/SingleValidation.tsx
  - frontend/src/tests/components/DeepValidationTab.test.tsx
autonomous: true
requirements:
  - DVAL-01
  - DVAL-02
  - DVAL-03
  - DVAL-04
  - DVAL-05
  - DVAL-06
  - DVAL-07
  - DVAL-08
  - DVAL-09
  - DVAL-10
  - DVAL-11
  - DVAL-12
  - DVAL-13
  - DVAL-14
  - DVAL-15
  - DVAL-16
  - DVAL-17

must_haves:
  truths:
    - "Users see a 'Deep Validation' tab in single validation results, separate from existing validation results"
    - "Deep Validation tab shows collapsible sections grouped by domain (Stereo & Tautomers, Chemical Composition, Structural Complexity)"
    - "Users can toggle between Category view and Severity view via a segmented control"
    - "Users can configure severity per check via a gear icon settings panel; overrides persist in localStorage"
    - "Clicking atom indices in check results highlights corresponding atoms on the molecule viewer"
    - "Stereoisomer enumeration results show a collapsible list of enumerated SMILES"
    - "Mixture detection results show a fragment classification table with SMILES, MW, classification, and pattern name"
  artifacts:
    - path: "frontend/src/components/validation/DeepValidationTab.tsx"
      provides: "Main tab container with segmented control and gear icon"
      contains: "DeepValidationTab"
    - path: "frontend/src/components/validation/DeepCheckCard.tsx"
      provides: "Individual check result card with structured detail rendering"
      contains: "DeepCheckCard"
    - path: "frontend/src/components/validation/SeverityConfigPanel.tsx"
      provides: "Severity configuration modal/panel"
      contains: "SeverityConfigPanel"
    - path: "frontend/src/hooks/useDeepValidationConfig.ts"
      provides: "localStorage-backed severity config hook"
      contains: "useDeepValidationConfig"
    - path: "frontend/src/pages/SingleValidation.tsx"
      provides: "Deep Validation tab entry added to tab list"
      contains: "deep-validation"
  key_links:
    - from: "frontend/src/components/validation/DeepValidationTab.tsx"
      to: "frontend/src/hooks/useDeepValidationConfig.ts"
      via: "useDeepValidationConfig hook import"
      pattern: "useDeepValidationConfig"
    - from: "frontend/src/components/validation/DeepCheckCard.tsx"
      to: "frontend/src/pages/SingleValidation.tsx"
      via: "onHighlightAtoms callback for atom cross-linking"
      pattern: "onHighlightAtoms"
    - from: "frontend/src/pages/SingleValidation.tsx"
      to: "frontend/src/components/validation/DeepValidationTab.tsx"
      via: "tab rendering in SingleValidation page"
      pattern: "DeepValidationTab"
---

<objective>
Build the frontend "Deep Validation" tab for the single validation results page. This includes: TypeScript types for deep check structured details, a localStorage-backed severity configuration hook, the main tab component with domain-grouped collapsible sections and a segmented control (Category | Severity views), a severity config panel (gear icon modal), specialized display components for stereoisomer lists and fragment classification tables, and interactive atom-level cross-linking to the molecule viewer.

Purpose: Users see all 17 deep validation check results in a polished, interactive tab that lets them configure severity levels and navigate atom-level findings directly on the molecular structure.

Output: New Deep Validation tab fully integrated into SingleValidation.tsx with all user-locked decisions implemented.
</objective>

<execution_context>
@/Users/kohulanrajan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kohulanrajan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-deep-validation/01-CONTEXT.md
@.planning/phases/01-deep-validation/01-RESEARCH.md
@.planning/phases/01-deep-validation/01-01-SUMMARY.md
@.planning/phases/01-deep-validation/01-02-SUMMARY.md
@.planning/phases/01-deep-validation/01-03-SUMMARY.md
@frontend/src/types/validation.ts
@frontend/src/hooks/useLocalStorage.ts
@frontend/src/pages/SingleValidation.tsx
@frontend/src/components/validation/ValidationResults.tsx
@frontend/src/components/validation/IssueCard.tsx
@frontend/src/components/molecules/MoleculeViewer.tsx
@frontend/src/tests/components/ValidationResults.test.tsx
@frontend/src/tests/setup.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add deep validation types and severity config hook</name>
  <files>
    frontend/src/types/validation.ts
    frontend/src/hooks/useDeepValidationConfig.ts
  </files>
  <action>
**1. Extend `frontend/src/types/validation.ts`:**

Add the following TypeScript interfaces after the existing types. These are typed shapes for the `details` field of deep validation CheckResults:

```typescript
// === Deep Validation Detail Types ===

// DVAL-01/02: Stereoisomer enumeration
export interface StereoisomerDetail {
  undefined_count: number;
  total_centers: number;
  atom_indices: number[];
  stereoisomer_smiles: string[];
  enumeration_cap: number;
  cap_exceeded: boolean;
}

// DVAL-03: Tautomer detection
export interface TautomerDetail {
  tautomer_count: number;
  canonical_smiles: string;
  is_canonical_form: boolean;
  tautomer_smiles: string[];
}

// DVAL-04: Aromatic system validation
export interface AromaticSystemDetail {
  unusual_ring_sizes: Array<{ ring_size: number; atom_indices: number[] }>;
  charged_aromatics: Array<{ atom_idx: number; symbol: string; charge: number }>;
}

// DVAL-05: Coordinate dimension
export interface CoordinateDimensionDetail {
  dimension: '2d' | '3d' | 'no_coordinates' | 'degenerate';
  num_conformers: number;
}

// DVAL-06: Mixture detection
export interface FragmentDetail {
  smiles: string;
  molecular_weight: number;
  heavy_atom_count: number;
  classification: 'drug' | 'salt' | 'solvent' | 'unknown';
  pattern_name: string | null;
}

export interface MixtureDetail {
  num_fragments: number;
  fragments: FragmentDetail[];
}

// DVAL-07: Solvent contamination
export interface SolventDetail {
  solvents_found: Array<{ name: string; smiles: string; molecular_weight: number }>;
  is_pure_solvent: boolean;
}

// DVAL-08: Inorganic filter
export interface InorganicDetail {
  has_carbon: boolean;
  is_inorganic: boolean;
  is_organometallic: boolean;
  metal_atoms: Array<{ atom_idx: number; symbol: string; atomic_num: number }>;
  element_counts: Record<string, number>;
}

// DVAL-09: Radical detection
export interface RadicalDetail {
  radical_atoms: Array<{ atom_idx: number; symbol: string; num_radical_electrons: number }>;
  total_radical_electrons: number;
}

// DVAL-10: Isotope label detection
export interface IsotopeDetail {
  labeled_atoms: Array<{ atom_idx: number; symbol: string; isotope_mass: number; common_name: string | null }>;
  total_labeled: number;
}

// DVAL-11: Trivial molecule
export interface TrivialMoleculeDetail {
  heavy_atom_count: number;
  num_bonds: number;
  is_single_atom: boolean;
  threshold: number;
}

// DVAL-12: Hypervalent atoms
export interface HypervalentDetail {
  hypervalent_atoms: Array<{ atom_idx: number; symbol: string; actual_valence: number; allowed_valences: number[] }>;
}

// DVAL-13: Polymer detection
export interface PolymerDetail {
  has_sgroup_markers: boolean;
  sgroup_types: string[];
  molecular_weight: number;
  exceeds_mw_threshold: boolean;
  has_dummy_atoms: boolean;
  dummy_atom_count: number;
}

// DVAL-14: Ring strain
export interface RingStrainDetail {
  strained_rings: Array<{ ring_size: number; atom_indices: number[] }>;
  total_strained_rings: number;
}

// DVAL-15: Macrocycle detection
export interface MacrocycleDetail {
  macrocycles: Array<{ ring_size: number; atom_indices: number[] }>;
  total_macrocycles: number;
  sssr_note: string;
}

// DVAL-16: Charged species
export interface ChargedSpeciesDetail {
  net_charge: number;
  positive_atoms: Array<{ atom_idx: number; symbol: string; charge: number }>;
  negative_atoms: Array<{ atom_idx: number; symbol: string; charge: number }>;
  is_zwitterion: boolean;
  total_charged_atoms: number;
}

// DVAL-17: Explicit hydrogen audit
export interface ExplicitHydrogenDetail {
  atoms_with_explicit_h: Array<{ atom_idx: number; symbol: string; explicit_h_count: number }>;
  total_explicit_h: number;
  has_h_atom_objects: boolean;
  h_atom_object_count: number;
}

// Severity override type
export type SeverityOverride = 'error' | 'warning' | 'info';

export interface DeepValidationConfig {
  severityOverrides: Record<string, SeverityOverride>;
}

// Domain grouping for deep checks
export type DeepValidationDomain = 'stereo_tautomer' | 'chemical_composition' | 'structural_complexity';

export const DEEP_CHECK_DOMAINS: Record<DeepValidationDomain, { label: string; checks: string[] }> = {
  stereo_tautomer: {
    label: 'Stereo & Tautomers',
    checks: ['stereoisomer_enumeration', 'tautomer_detection', 'aromatic_system_validation', 'coordinate_dimension'],
  },
  chemical_composition: {
    label: 'Chemical Composition',
    checks: ['mixture_detection', 'solvent_contamination', 'inorganic_filter', 'radical_detection', 'isotope_label_detection', 'trivial_molecule'],
  },
  structural_complexity: {
    label: 'Structural Complexity',
    checks: ['hypervalent_atoms', 'polymer_detection', 'ring_strain', 'macrocycle_detection', 'charged_species', 'explicit_hydrogen_audit'],
  },
};
```

Also export all new types at the bottom of the file in the existing export block (or add them to it).

**2. Create `frontend/src/hooks/useDeepValidationConfig.ts`:**

```typescript
import { useLocalStorage } from './useLocalStorage';
import type { DeepValidationConfig, SeverityOverride } from '../types/validation';

const DEFAULT_CONFIG: DeepValidationConfig = {
  severityOverrides: {},
};

export function useDeepValidationConfig() {
  const [config, setConfig, clearConfig] = useLocalStorage<DeepValidationConfig>(
    'chemaudit:deep-validation-config',
    DEFAULT_CONFIG
  );

  const setSeverityOverride = (checkName: string, severity: SeverityOverride) => {
    setConfig((prev: DeepValidationConfig) => ({
      ...prev,
      severityOverrides: { ...prev.severityOverrides, [checkName]: severity },
    }));
  };

  const removeSeverityOverride = (checkName: string) => {
    setConfig((prev: DeepValidationConfig) => {
      const { [checkName]: _, ...rest } = prev.severityOverrides;
      return { ...prev, severityOverrides: rest };
    });
  };

  const resetAllOverrides = () => {
    setConfig(DEFAULT_CONFIG);
  };

  const getEffectiveSeverity = (checkName: string, defaultSeverity: string): string => {
    return config.severityOverrides[checkName] || defaultSeverity;
  };

  return {
    config,
    setSeverityOverride,
    removeSeverityOverride,
    resetAllOverrides,
    getEffectiveSeverity,
    clearConfig,
  };
}
```

Use the existing `useLocalStorage` hook (at `frontend/src/hooks/useLocalStorage.ts`) — do NOT reimplement localStorage handling.
  </action>
  <verify>
    <automated>cd /Volumes/Data_Drive/Project/2026/chemstructval/frontend && npx tsc --noEmit --pretty 2>&1 | head -20</automated>
    <manual>Verify the new types compile without errors and useDeepValidationConfig hook exports correctly</manual>
  </verify>
  <done>Deep validation TypeScript types added to validation.ts; useDeepValidationConfig hook created using existing useLocalStorage hook; all types compile without errors</done>
</task>

<task type="auto">
  <name>Task 2: Build Deep Validation tab with all sub-components and integrate into SingleValidation</name>
  <files>
    frontend/src/components/validation/DeepValidationTab.tsx
    frontend/src/components/validation/DeepCheckCard.tsx
    frontend/src/components/validation/SeverityConfigPanel.tsx
    frontend/src/components/validation/StereoisomerList.tsx
    frontend/src/components/validation/FragmentClassificationTable.tsx
    frontend/src/pages/SingleValidation.tsx
  </files>
  <action>
**1. Create `frontend/src/components/validation/StereoisomerList.tsx`:**
A collapsible list of enumerated stereoisomer SMILES strings.
- Props: `{ smiles: string[]; cap: number; capExceeded: boolean }`
- When collapsed: show "X stereoisomers" with expand button
- When expanded: show numbered list of SMILES, each with a CopyButton (import from existing `../ui/CopyButton`)
- If capExceeded: show "Showing count only — {cap} cap exceeded" message
- Use Framer Motion `AnimatePresence` for smooth expand/collapse (follow existing animation patterns)
- Tailwind styling using existing CSS variables: `var(--color-surface-*)`, `var(--color-text-*)`

**2. Create `frontend/src/components/validation/FragmentClassificationTable.tsx`:**
A mini-table displaying mixture fragment classifications (per user decision: "a proper mini-table, not just a summary line").
- Props: `{ fragments: FragmentDetail[] }` (import `FragmentDetail` type)
- Render HTML table with columns: Fragment (SMILES), MW, Classification, Pattern
- Classification badges: 'drug' → green, 'salt' → blue, 'solvent' → yellow, 'unknown' → gray
- Each classification rendered as a colored `Badge` component (import from `../ui/Badge`)
- Compact styling with `text-xs`, borders using CSS variables
- Responsive: horizontal scroll on narrow screens

**3. Create `frontend/src/components/validation/DeepCheckCard.tsx`:**
Renders one deep check result with structured detail fields and atom index highlighting.
- Props: `{ check: CheckResult; effectiveSeverity: string; onHighlightAtoms: (atoms: number[]) => void }`
- Header: check name (human-readable, formatted from snake_case), severity badge (use effectiveSeverity for display, show original if overridden), pass/fail icon
- Message: human-readable message string
- Affected atoms: if `affected_atoms.length > 0`, show clickable atom indices. Clicking an index calls `onHighlightAtoms([index])`. Clicking "highlight all" calls `onHighlightAtoms(affected_atoms)`. Style atom indices as small clickable badges.
- Detail rendering: Based on `check.check_name`, render the appropriate structured detail:
  - `stereoisomer_enumeration`: render `<StereoisomerList>` component
  - `mixture_detection`: render `<FragmentClassificationTable>` component
  - `tautomer_detection`: show canonical SMILES, tautomer count, is_canonical flag
  - `charged_species`: show net charge, zwitterion flag, charged atom list
  - `ring_strain` / `macrocycle_detection`: show ring sizes with clickable atom indices
  - Other checks: render details as a formatted key-value list (generic fallback)
- All detail sections collapsible (start collapsed, expand on click)
- Use Framer Motion for collapse/expand animation

**4. Create `frontend/src/components/validation/SeverityConfigPanel.tsx`:**
A modal/panel for configuring per-check severity levels.
- Props: `{ isOpen: boolean; onClose: () => void; checks: CheckResult[]; config: DeepValidationConfig; onSetSeverity: (checkName: string, severity: SeverityOverride) => void; onRemoveOverride: (checkName: string) => void; onResetAll: () => void }`
- Render as a modal overlay (use same modal pattern as existing modals in the project, or a right-side panel)
- List all deep validation checks grouped by domain
- For each check: show check name, current severity (badge), and a 3-button toggle (ERROR | WARNING | INFO)
- Highlight overridden checks with a visual indicator (e.g., dot or underline)
- "Reset All" button at bottom to clear all overrides
- Close button in header
- Framer Motion enter/exit animation (slide in from right or fade)

**5. Create `frontend/src/components/validation/DeepValidationTab.tsx`:**
Main tab container — the primary component rendered when the "Deep Validation" tab is active.
- Props: `{ checks: CheckResult[]; onHighlightAtoms: (atoms: number[]) => void }`
- State: `viewMode` ('category' | 'severity'), `configOpen` (boolean)
- Use `useDeepValidationConfig()` hook for severity config
- Tab header area:
  - Segmented control: "Category | Severity" toggle (per locked decision)
  - Gear icon button to open `SeverityConfigPanel` (per locked decision)
- Category view (`viewMode === 'category'`):
  - Three collapsible sections: "Stereo & Tautomers", "Chemical Composition", "Structural Complexity"
  - Each section shows a summary header (count of issues, worst severity) and contains `DeepCheckCard` for each check in that domain
  - Use `DEEP_CHECK_DOMAINS` from types to map checks to domains
  - Default: all sections expanded. Clicking header collapses/expands.
- Severity view (`viewMode === 'severity'`):
  - Group checks by their effective severity (ERROR first, then WARNING, then INFO, then PASS)
  - Each group shows severity badge and count as header
  - Same `DeepCheckCard` rendering within each group
- User-adjusted verdict:
  - At the top of the tab, show a summary: total checks, passed, issues by severity
  - Compute a "Deep Validation Verdict" based on EFFECTIVE severities (after user overrides):
    - If any check with effective severity ERROR fails → verdict "FAIL" (red)
    - If any check with effective severity WARNING fails → verdict "WARNING" (amber)
    - Else → verdict "PASS" (green)
  - This is the "dynamic verdict" per user decision — separate from the backend overall_score
- Filter deep checks: from `checks` prop, filter to only checks whose `check_name` is in `DEEP_CHECK_DOMAINS` (the 16 deep validation check names). This separates them from the existing v1 checks.

**6. Modify `frontend/src/pages/SingleValidation.tsx`:**
- Add `'deep-validation'` to the `TabType` union: `type TabType = 'validate' | 'deep-validation' | 'database' | 'alerts' | 'standardize';`
- Add a new tab config to the `TABS` array (insert after 'validate'):
  ```typescript
  {
    id: 'deep-validation',
    label: 'Deep Validation',
    icon: <Microscope className="w-4 h-4" />,  // or <Search> or <Zap> — use an appropriate Lucide icon
    description: 'Advanced structure checks: stereo, tautomers, composition, and complexity analysis',
  },
  ```
- Import `Microscope` (or chosen icon) from `lucide-react`
- Import `DeepValidationTab` from `../components/validation/DeepValidationTab`
- In the tab content rendering section (where `activeTab` determines which component renders), add:
  ```tsx
  {activeTab === 'deep-validation' && validationResult && (
    <DeepValidationTab
      checks={validationResult.all_checks}
      onHighlightAtoms={handleHighlightAtoms}
    />
  )}
  ```
- The `handleHighlightAtoms` callback should already exist (or similar, used by IssueCard). If not, create one that sets the `highlightAtoms` state passed to `MoleculeViewer`. Check the existing code to see if `highlightedAtoms` state and `onHighlightAtoms` prop pattern is already wired — if so, reuse it.

**Style consistency:**
- Use existing CSS variables (`var(--color-surface-elevated)`, `var(--color-primary)`, etc.)
- Use existing utility classes and patterns from `ValidationResults.tsx` and `IssueCard.tsx`
- Use `cn()` utility for conditional class names (imported from `../lib/utils`)
- Framer Motion for all expand/collapse and enter/exit animations

**Production quality per user decision "Everything should be production level":**
- Loading state: show skeleton cards while validation is processing (match existing loading patterns)
- Empty state: if no deep validation checks found in results, show a message explaining this
- Error handling: if check results are malformed, render gracefully with fallback
  </action>
  <verify>
    <automated>cd /Volumes/Data_Drive/Project/2026/chemstructval/frontend && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
    <manual>
1. Start frontend dev server: `cd frontend && npm run dev`
2. Navigate to single validation page
3. Enter a SMILES (e.g., "CC(O)C(N)CC" for stereo test, "CCN.Cl" for mixture test)
4. Click Validate
5. Verify "Deep Validation" tab appears in tab bar
6. Click Deep Validation tab — verify 3 collapsible domain sections appear
7. Toggle segmented control to Severity view — verify checks re-group by severity
8. Click gear icon — verify severity config panel opens
9. Change a check severity from WARNING to ERROR — verify it reflects immediately
10. Click atom indices in a check result — verify molecule viewer highlights those atoms
    </manual>
  </verify>
  <done>Deep Validation tab renders with all 16 check results, supports Category/Severity views, severity config persists in localStorage, atom cross-linking works with molecule viewer</done>
</task>

<task type="auto">
  <name>Task 3: Write frontend tests for Deep Validation tab</name>
  <files>
    frontend/src/tests/components/DeepValidationTab.test.tsx
  </files>
  <action>
Create `frontend/src/tests/components/DeepValidationTab.test.tsx` following the pattern of `ValidationResults.test.tsx`.

Import from `../setup` for `render`, `screen`, `fireEvent`. Import `vi` from vitest.

**Create mock factory:**
```typescript
const createMockDeepCheck = (overrides: Partial<CheckResult> = {}): CheckResult => ({
  check_name: 'stereoisomer_enumeration',
  passed: true,
  severity: 'info',
  message: 'No undefined stereocenters found.',
  affected_atoms: [],
  details: {},
  ...overrides,
});
```

Create a helper that generates a full set of 16 mock deep check results (one per check name from DEEP_CHECK_DOMAINS).

**Test suites:**

**describe('DeepValidationTab'):**
- `it('renders the tab with segmented control')`: Render with mock checks, verify "Category" and "Severity" buttons exist
- `it('shows three domain sections in category view')`: Verify "Stereo & Tautomers", "Chemical Composition", "Structural Complexity" section headers
- `it('toggles to severity view')`: Click "Severity" button, verify checks are grouped by severity level
- `it('shows gear icon for config')`: Verify settings icon/button exists
- `it('filters to only deep validation checks')`: Pass a mix of v1 and deep checks, verify only deep checks are rendered in the tab
- `it('shows verdict based on effective severities')`: With all checks passing → "PASS" verdict

**describe('DeepCheckCard'):**
- `it('renders check name and message')`: Verify check name and message text appear
- `it('renders severity badge')`: Verify severity badge with correct text
- `it('calls onHighlightAtoms when atom index clicked')`: Render with affected_atoms=[0,1,2], click an atom badge, verify callback called with correct atoms
- `it('renders stereoisomer list for stereoisomer_enumeration check')`: Pass check with stereoisomer details, verify SMILES list renders
- `it('renders fragment table for mixture_detection check')`: Pass check with mixture details, verify table renders with fragment rows

**describe('SeverityConfigPanel'):**
- `it('renders check list grouped by domain')`: Verify all 16 check names appear
- `it('calls onSetSeverity when severity button clicked')`: Click ERROR button for a check, verify callback
- `it('calls onResetAll when reset button clicked')`: Click reset, verify callback

**describe('StereoisomerList'):**
- `it('renders collapsed by default with count')`: Verify "X stereoisomers" text
- `it('expands to show SMILES list on click')`: Click expand, verify individual SMILES strings appear
- `it('shows cap exceeded message')`: With capExceeded=true, verify warning message

**describe('FragmentClassificationTable'):**
- `it('renders table with fragment rows')`: Pass 3 fragments, verify 3 rows
- `it('shows classification badges with correct colors')`: Verify drug=green, salt=blue, solvent=yellow

Do NOT mock RDKit (not needed for these tests — they're pure React component tests). Mock `useDeepValidationConfig` hook if needed to control config state. Use `vi.fn()` for callback props.
  </action>
  <verify>
    <automated>cd /Volumes/Data_Drive/Project/2026/chemstructval/frontend && npx vitest run src/tests/components/DeepValidationTab.test.tsx 2>&1 | tail -20</automated>
  </verify>
  <done>All frontend tests pass for DeepValidationTab, DeepCheckCard, SeverityConfigPanel, StereoisomerList, and FragmentClassificationTable components</done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` — zero TypeScript errors
2. `cd frontend && npx vitest run src/tests/components/DeepValidationTab.test.tsx` — all tests pass
3. `cd frontend && npm run lint` — zero lint errors in new files
4. Manual: Start dev server, validate a molecule, verify Deep Validation tab appears and functions correctly
5. Manual: Verify atom highlighting works end-to-end (click atom index → molecule viewer highlights)
6. Manual: Verify severity config persists after page refresh (localStorage)
</verification>

<success_criteria>
- Deep Validation tab appears in SingleValidation page after the "Validate & Score" tab
- Category view shows 3 collapsible domain sections with correct check groupings
- Severity view re-groups checks by effective severity level
- Gear icon opens severity config panel with per-check ERROR/WARNING/INFO toggles
- Severity overrides persist in localStorage across page refreshes
- Dynamic verdict reflects user's severity overrides (not just backend score)
- Clicking atom indices in check results triggers molecule viewer highlighting
- Stereoisomer SMILES displayed in collapsible list with copy buttons
- Fragment classification rendered as proper mini-table with colored classification badges
- All components production quality: loading states, empty states, error handling
- TypeScript compiles without errors; lint passes; tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/01-deep-validation/01-04-SUMMARY.md`
</output>
